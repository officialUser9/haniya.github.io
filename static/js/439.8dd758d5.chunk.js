"use strict";(self.webpackChunkmodernize=self.webpackChunkmodernize||[]).push([[439],{2439:(e,n,a)=>{a.r(n),a.d(n,{default:()=>E});var r,s=a(7528),i=a(9950),t=a(9246),l=a(4695),d=a.n(l),o=a(9928),c=a(8429),m=a(2683),h=a(7233),g=a(2346),u=a(2633),p=a(4139),x=a(2854),j=a(1231),y=a(4341),f=a(2145),A=a(6059),b=a(736),_=a(7987),v=a(4641),C=a(7535),w=a(2180),q=a(146),F=(a(7705),a(4414));const D=(0,q.A)(m.A)(r||(r=(0,s.A)(["\n  animation: fadeIn 0.5s ease-in-out;\n  ","\n"])),"\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n    transform: translateY(-20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n"),E=()=>{const[e,n]=(0,i.useState)(null),[a,r]=(0,i.useState)(!1),[s,l]=(0,i.useState)({first_name:"",last_name:"",email:"",phone:"",gender:"",postal_code:"",address_line1:"",city:"",desc:"",dob:"",language:[],age:"",image:"",role_id:null,gallery:[]}),[m,q]=(0,i.useState)(null),[E,T]=(0,i.useState)([]),[I,S]=(0,i.useState)({}),[k,P]=(0,i.useState)(null),N=(0,c.Zp)(),W=(0,i.useRef)(null),L=(0,i.useRef)(null),[G,U]=(0,i.useState)([]),B=new Date,M=new Date(B.getFullYear()-18,B.getMonth(),B.getDate()).toISOString().split("T")[0],O=e=>{const n=new Date(e),a=Date.now()-n.getTime(),r=new Date(a);return Math.abs(r.getUTCFullYear()-1970)};(0,i.useEffect)((()=>{(async()=>{try{const e=localStorage.getItem("uid");if(!e)throw new Error("User ID not found");const a=await t.A.get("http://134.209.145.149:9999/api/user-info?user_id=".concat(e));if(!a.data)throw new Error("Failed to fetch profile data");{const e=a.data;n(e),l({first_name:e.first_name||"",last_name:e.last_name||"",email:e.email||"",phone:e.phone||"",gender:e.gender||"",postal_code:e.postal_code||"",address_line1:e.address_line1||"",city:e.city||"",desc:e.desc||"",dob:e.dob||"",language:e.language||[],age:e.dob?O(e.dob):"",image:e.image||"",gallery:e.gallery||[]})}}catch(k){console.error("Error fetching profile:",k),P("Failed to fetch profile data")}})()}),[]),(0,i.useEffect)((()=>{(async()=>{try{const e=await t.A.get("http://134.209.145.149:9999/api/language");U(e.data)}catch(k){console.error("Failed to fetch languages:",k)}})()}),[]);const R=e=>{const{name:n,value:a,type:r,multiple:s}=e.target;if(s)l((a=>({...a,[n]:Array.from(e.target.selectedOptions,(e=>e.value))})));else{if(l((e=>({...e,[n]:a}))),"phone"===n){if(a.length>10)return;isNaN(a)||10!==a.length?S((e=>({...e,[n]:"Phone number must be 10 digits long"}))):S((e=>({...e,[n]:""})))}if("postal_code"===n){if(a.length>6)return;isNaN(a)||6!==a.length?S((e=>({...e,[n]:"Postal Code must be 6 digits long"}))):S((e=>({...e,[n]:""})))}if("dob"===n){const e=O(a);S(e<18?e=>({...e,age:"Age must be at least 18"}):e=>({...e,age:""})),l((n=>({...n,age:e})))}}};return k?(0,F.jsx)(h.A,{color:"error",children:k}):e?(0,F.jsxs)(o.A,{children:[(0,F.jsx)(g.A,{sx:{display:"flex",alignItems:"center",mb:2},children:(0,F.jsx)(h.A,{variant:"h3",component:"h2",sx:{flex:1},children:"My Profile"})}),(0,F.jsx)(w.N9,{}),(0,F.jsx)(D,{elevation:3,sx:{padding:4,marginTop:4},children:(0,F.jsx)(u.A,{children:(0,F.jsxs)(p.Ay,{container:!0,spacing:4,alignItems:"center",direction:"column",children:[(0,F.jsxs)(p.Ay,{item:!0,children:[(0,F.jsx)(x.A,{src:s.image||"/path/to/avatar.jpg",sx:{width:120,height:120,bgcolor:"primary.main",fontSize:50,marginBottom:2,cursor:a?"pointer":"default"},onClick:a?()=>W.current.click():null,children:e.first_name?e.first_name.charAt(0):"U"}),(0,F.jsx)("input",{type:"file",accept:"image/*",ref:W,style:{display:"none"},onChange:e=>{const n=e.target.files[0];if(n){q(n);const e=new FileReader;e.onloadend=()=>{l((n=>({...n,image:e.result})))},e.readAsDataURL(n)}},disabled:!a})]}),3===(null===e||void 0===e?void 0:e.role_id)&&(0,F.jsx)(p.Ay,{container:!0,spacing:2,alignItems:"center",direction:"column",children:(0,F.jsxs)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:[(0,F.jsx)(h.A,{variant:"body1",children:(0,F.jsx)("strong",{children:"Rating:"})}),(0,F.jsx)(j.A,{value:4,readOnly:!0})]})}),a?(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)(p.Ay,{item:!0,container:!0,spacing:2,children:[(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsx)(y.A,{name:"first_name",label:"First Name",value:s.first_name,onChange:R,fullWidth:!0,required:!0,error:!!I.first_name,helperText:I.first_name})}),(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsx)(y.A,{name:"last_name",label:"Last Name",value:s.last_name,onChange:R,fullWidth:!0,required:!0,error:!!I.last_name,helperText:I.last_name})}),(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsx)(y.A,{name:"email",label:"Email",value:s.email,onChange:R,fullWidth:!0,required:!0,error:!!I.email,disabled:!0,helperText:I.email})})]}),(0,F.jsxs)(p.Ay,{item:!0,container:!0,spacing:2,children:[(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsx)(y.A,{type:"number",name:"phone",label:"Phone",value:s.phone,onChange:R,fullWidth:!0,required:!0,error:!!I.phone,helperText:I.phone})}),(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsxs)(f.A,{fullWidth:!0,required:!0,error:!!I.gender,children:[(0,F.jsx)(A.A,{children:"Gender"}),(0,F.jsxs)(b.A,{name:"gender",value:s.gender,onChange:R,label:"Gender",children:[(0,F.jsx)(_.A,{value:"male",children:"Male"}),(0,F.jsx)(_.A,{value:"female",children:"Female"}),(0,F.jsx)(_.A,{value:"other",children:"Other"})]}),I.gender&&(0,F.jsx)(v.A,{children:I.gender})]})}),(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsx)(y.A,{type:"number",name:"postal_code",label:"Postal code",value:s.postal_code,onChange:R,fullWidth:!0,required:!0,error:!!I.postal_code,helperText:I.postal_code})})]}),(0,F.jsxs)(p.Ay,{item:!0,container:!0,spacing:2,children:[(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsx)(y.A,{name:"address_line1",label:"Address1",value:s.address_line1,onChange:R,fullWidth:!0,required:!0,error:!!I.address_line1,helperText:I.address_line1})}),(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsx)(y.A,{name:"city",label:"City",value:s.city,onChange:R,fullWidth:!0,required:!0,error:!!I.city,helperText:I.city})}),(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsx)(y.A,{name:"dob",label:"Date of Birth",type:"date",value:s.dob,onChange:R,fullWidth:!0,InputLabelProps:{shrink:!0},inputProps:{max:M},error:!!I.dob,helperText:I.dob,required:!0})})]}),(0,F.jsxs)(p.Ay,{item:!0,container:!0,spacing:2,children:[(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsxs)(f.A,{fullWidth:!0,required:!0,error:!!I.language,children:[(0,F.jsx)(A.A,{children:"Language"}),(0,F.jsx)(b.A,{name:"language",value:s.language,onChange:R,label:"Language",multiple:!0,children:G.map((e=>(0,F.jsx)(_.A,{value:e.id,children:e.name},e.value)))}),I.language&&(0,F.jsx)(v.A,{children:I.language})]})}),(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsx)(y.A,{name:"desc",label:"Description",value:s.desc,onChange:R,fullWidth:!0,required:!0,error:!!I.desc,helperText:I.desc})}),(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsx)(y.A,{name:"age",label:"Age",value:s.age,onChange:R,fullWidth:!0,required:!0,error:!!I.age,helperText:I.age,disabled:!0})})]}),(0,F.jsx)(p.Ay,{item:!0,container:!0,spacing:2,children:(0,F.jsxs)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:[(0,F.jsx)(h.A,{children:"Gallery"}),(0,F.jsx)("input",{type:"file",accept:"image/*",multiple:!0,ref:L,style:{display:"none"},onChange:async e=>{const n=e.target.files,a=localStorage.getItem("uid");if(!a)return void alert("User ID not found");const r=new FormData;for(let s=0;s<n.length;s++)r.append("files",n[s]);r.append("user_id",a);try{const e=await t.A.post("http://134.209.145.149:9999/api/gallery",r,{headers:{"Content-Type":"multipart/form-data"}});if(!e.data)throw new Error(e.data.message||"Failed to upload images");d().fire({icon:"success",title:"Images Uploaded successfully!",showConfirmButton:!1,timer:3e3}),console.log("Gallery images uploaded successfully")}catch(k){console.error("Error uploading images:",k),d().fire({title:"Error",text:k.message||"Failed to upload images",icon:"error"})}},disabled:!a}),(0,F.jsx)(C.A,{variant:"outlined",onClick:()=>L.current.click(),disabled:!a,children:"Upload Gallery Images"})]})}),(0,F.jsxs)(p.Ay,{container:!0,spacing:2,justifyContent:"center",children:[(0,F.jsx)(p.Ay,{item:!0,children:(0,F.jsx)(C.A,{variant:"contained",color:"primary",onClick:async()=>{const e={};if(s.first_name||(e.first_name="First name is required"),s.last_name||(e.last_name="Last name is required"),s.email||(e.email="Email is required"),s.phone?(10!==s.phone.length||isNaN(s.phone))&&(e.phone="Phone number must be exactly 10 digits"):e.phone="Phone number is required",s.gender||(e.gender="Gender is required"),s.postal_code?(6!==s.postal_code.length||isNaN(s.postal_code))&&(e.postal_code="Postal code must be exactly 6 digits"):e.postal_code="Postal code is required",s.address_line1||(e.address_line1="Address is required"),s.age||(e.age="Age is required"),s.dob||(e.dob="Date of birth is required"),s.language||(e.language="Language is required"),s.desc||(e.desc="Description is required"),Object.keys(e).length>0)return S(e),void d().fire({icon:"error",title:"Error",text:"Please fill in all required fields.",showConfirmButton:!0,timer:3e3});try{const e=localStorage.getItem("uid");if(!e)throw new Error("User ID not found");const a=new FormData;a.append("uid",e),a.append("first_name",s.first_name),a.append("last_name",s.last_name),a.append("email",s.email),a.append("phone",s.phone),a.append("gender",s.gender),a.append("postal_code",s.postal_code),a.append("address_line1",s.address_line1),a.append("age",s.age),a.append("dob",s.dob),a.append("language",s.language),a.append("desc",s.desc),m&&a.append("image",m);const i=await t.A.put("http://134.209.145.149:9999/api/users/".concat(e),a,{headers:{"Content-Type":"multipart/form-data"}});if(!i.data)throw new Error(i.data.Message||"Failed to update profile");n(s),r(!1),d().fire({icon:"success",title:"Profile updated successfully!",showConfirmButton:!1,timer:3e3}),setTimeout((()=>{N("/profile")}),3e3),window.location.reload()}catch(k){console.error("Error updating profile:",k),P(k.message||"Failed to update profile"),d().fire({icon:"error",title:"Error",text:k.message||"Failed to update profile"})}},children:"Save"})}),(0,F.jsx)(p.Ay,{item:!0,children:(0,F.jsx)(C.A,{variant:"outlined",color:"secondary",onClick:()=>r(!1),children:"Cancel"})})]})]}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)(p.Ay,{item:!0,container:!0,spacing:2,children:[(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsxs)(h.A,{variant:"body1",children:[(0,F.jsx)("strong",{children:"First Name:"})," ",e.first_name]})}),(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsxs)(h.A,{variant:"body1",children:[(0,F.jsx)("strong",{children:"Last Name:"})," ",e.last_name]})}),(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsxs)(h.A,{variant:"body1",children:[(0,F.jsx)("strong",{children:"Email:"})," ",e.email]})})]}),(0,F.jsxs)(p.Ay,{item:!0,container:!0,spacing:2,children:[(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsxs)(h.A,{variant:"body1",children:[(0,F.jsx)("strong",{children:"Phone:"})," ",e.phone]})}),(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsxs)(h.A,{variant:"body1",children:[(0,F.jsx)("strong",{children:"Gender:"})," ",e.gender]})}),(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsxs)(h.A,{variant:"body1",children:[(0,F.jsx)("strong",{children:"Zipcode:"})," ",e.postal_code]})})]}),(0,F.jsxs)(p.Ay,{item:!0,container:!0,spacing:2,children:[(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsxs)(h.A,{variant:"body1",children:[(0,F.jsx)("strong",{children:"Address:"})," ",e.address_line1]})}),(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsxs)(h.A,{variant:"body1",children:[(0,F.jsx)("strong",{children:"City:"})," ",e.city]})}),(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsxs)(h.A,{variant:"body1",children:[(0,F.jsx)("strong",{children:"Date of Birth:"})," ",e.dob]})}),(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsxs)(h.A,{variant:"body1",children:[(0,F.jsx)("strong",{children:"Gender:"})," ",e.gender]})}),(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsxs)(h.A,{variant:"body1",children:[(0,F.jsx)("strong",{children:"Language:"})," ",e.language_name]})}),(0,F.jsx)(p.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,F.jsxs)(h.A,{variant:"body1",children:[(0,F.jsx)("strong",{children:"Description:"})," ",e.desc]})})]}),(0,F.jsx)(p.Ay,{item:!0,container:!0,spacing:2}),(0,F.jsx)(g.A,{display:"flex",justifyContent:"center",mt:2,children:(0,F.jsx)(C.A,{variant:"contained",color:"primary",onClick:()=>r(!0),children:"Edit"})})]})]})})})]}):(0,F.jsx)(h.A,{children:"Loading..."})}}}]);